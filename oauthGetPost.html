<head>
	<meta charset="UTF-8">
</head>
<script>

async function getToken(code){
		const apiclientid = '38180';
		const rqURL = 'https://www.bungie.net/platform/app/oauth/token/';
		const data = 'client_id=' + apiclientid + '&code=' + code + '&grant_type=authorization_code';
		const auth = await postData(rqURL, data, false);
		window.opener.postMessage(auth, "*");
}

	if (localStorage.getItem('oauthWatcher')) {
		const queryString = window.location.search;
		const urlParams = new URLSearchParams(queryString);
		const code = urlParams.get('code');
		getToken(code);
	}

</script>